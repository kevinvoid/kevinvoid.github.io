---
layout: post
title:  "java查看VM命令行工具"
date:   2020-05-18 18:15:02 +0800
categories: java
---


### 前言
- jvm常用常看命令
- 可视化工具

### jps
- **定义**:  lists the instrumented HotSpot Java Virtual Machines (JVMs) on the target system. The tool is limited to reporting information on JVMs for which it has the access permissions.
- **官网链接**: [jps命令](https://docs.oracle.com/javase/8/docs/technotes/tools/share/jps.html)
- **格式**: jps [ options ] [ hostid ]
	hostid: [protocol:][[//]hostname][:port][/servername]
- **示例**:
	- jps
	```
	54336 Launcher
	54337 ContactApplication
	274
	55030 Jps
	54647 Launcher
	```
	- jps -l localhost
	- jps -m localhost:8888
	- jps -v

### jstat(示例中使用pid是contcat-webapp运行产生的pid)
- **定义**: displays performance statistics for an instrumented HotSpot Java virtual machine (JVM). The target JVM is identified by its virtual machine identifier, or vmid option described below.
- **官网链接**: [jstat命令](https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html)
- **格式**: jstat [ generalOption | outputOptions vmid [interval[s|ms] [count]] ]
- **示例**:
	- jstat -class 21716: 类加载统计  
	```
Loaded  Bytes  Unloaded  Bytes     Time
11781 21532.2        0     0.0       6.08
	```
	Loaded:加载class的数量  
	Bytes：所占用空间大小  
	Unloaded：未加载数量  
	Bytes:未加载占用空间  
	Time：时间  
	- jstat -compiler 21716    编译统计  
	```
Compiled Failed Invalid   Time   FailedType FailedMethod
8056      0       0     4.37          0
	```
	Compiled：编译数量  
	Failed：失败数量  
	Invalid：不可用数量  
	Time：时间  
	FailedType：失败类型  
	FailedMethod：失败的方法  
    - jstat -gc 21716 垃圾回收统计  
    ```
S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
0.0   8192.0  0.0   8192.0 150528.0 66560.0   115712.0   31559.5   60416.0 58643.3 7680.0 7021.8     14    0.245   0      0.000    0.245
    ```
    S0C：第一个幸存区的大小  
	S1C：第二个幸存区的大小  
	S0U：第一个幸存区的使用大小  
	S1U：第二个幸存区的使用大小  
	EC：伊甸园区的大小  
	EU：伊甸园区的使用大小  
	OC：老年代大小  
	OU：老年代使用大小  
	MC：方法区大小  
	MU：方法区使用大小  
	CCSC:压缩类空间大小  
	CCSU:压缩类空间使用大小  
	YGC：年轻代垃圾回收次数  
	YGCT：年轻代垃圾回收消耗时间  
	FGC：老年代垃圾回收次数  
	FGCT：老年代垃圾回收消耗时间  
	GCT：垃圾回收消耗总时间  

    - jstat -gccapacity 21716: 堆内存统计  
 	```
 	 NGCMN    NGCMX     NGC     S0C   S1C       EC      OGCMN      OGCMX       OGC         OC       MCMN     MCMX      MC     CCSMN    CCSMX     CCSC    YGC    FGC
     0.0 2097152.0 158720.0    0.0 8192.0 150528.0        0.0  2097152.0   115712.0   115712.0      0.0 1101824.0  60416.0      0.0 1048576.0   7680.0     14     0
	```	  
	NGCMN：新生代最小容量  
	NGCMX：新生代最大容量  
	NGC：当前新生代容量  
	S0C：第一个幸存区大小  
	S1C：第二个幸存区的大小  
	EC：伊甸园区的大小  
	OGCMN：老年代最小容量  
	OGCMX：老年代最大容量  
	OGC：当前老年代大小  
	OC:当前老年代大小  
	MCMN:最小元数据容量  
	MCMX：最大元数据容量  
	MC：当前元数据空间大小  
	CCSMN：最小压缩类空间大小  
	CCSMX：最大压缩类空间大小  
	CCSC：当前压缩类空间大小  
	YGC：年轻代gc次数  
	FGC：老年代GC次数  
	- jstat -gcnew 21716 新生代垃圾回收统计  
	```
	S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT
	0.0 8192.0    0.0 8192.0  2  15 8704.0 150528.0  66560.0     14    0.245
	```
	S0C：第一个幸存区大小
	S1C：第二个幸存区的大小
	S0U：第一个幸存区的使用大小
	S1U：第二个幸存区的使用大小
	TT:对象在新生代存活的次数
	MTT:对象在新生代存活的最大次数
	DSS:期望的幸存区大小
	EC：伊甸园区的大小
	EU：伊甸园区的使用大小
	YGC：年轻代垃圾回收次数
	YGCT：年轻代垃圾回收消耗时间
	- jstat -gcutil 21891 250 7  
		This example attaches to lvmid 21891 and takes 7 samples at 250 millisecond intervals and displays the output as specified by the -gcutil option.
	- jstat -gcnew -h3 21891 250  
		This example attaches to lvmid 21891 and takes samples at 250 millisecond intervals and displays the output as specified by -gcutil option. In addition, it uses the -h3 option to output the column header after every 3 lines of data.
	- jstat -gcoldcapacity -t 21891 250 3  
		This example attaches to lvmid 21891 and takes 3 samples at 250 millisecond intervals. The -t option is used to generate a time stamp for each sample in the first column.
	jstat -gcutil 40496@remote.domain 1000  
		This example attaches to lvmid 40496 on the system named remote.domain using the -gcutil option, with samples taken every second indefinitely.

### jinfo
- **定义**: java配置信息工具  查看正在运行的 java 应用程序的扩展参数，包括Java System属性和JVM命令行参数；也可以动态的修改正在运行的JVM一些参数
- **官网链接**: [jinfo命令](https://docs.oracle.com/javase/7/docs/technotes/tools/share/jinfo.html)
- **格式**: 
	- jinfo [ option ] pid
    - jinfo [ option ] executable core
    - jinfo [ option ] [server-id@]remote-hostname-or-IP
    - option
		- no option   输出全部的参数和系统属性
		- flag  name  输出对应名称的参数
		- flag [+ or -]name 开启或者关闭对应名称的参数
		- flag name=value  设定对应名称的参数
		- flags  输出全部的参数
		- sysprops  输出系统属性
		java -XX:+PrintFlagsFinal -version是输出全部的参数
		java -XX:+PrintFlagsFinal -version | grep 匹配查询
- **示例**:


### jmap
- **定义**: java内存映像工具 Java Memory Map  获得运行中的jvm的堆的快照，从而可以离线分析堆，以检查内存泄漏，检查一些严重影响性能的大对象的创建，检查系统	中什么对象最多，各种对象所占内存的大小等等。可以使用jmap生成Heap Dump
- **官网链接**: [jmap命令](https://docs.oracle.com/javase/7/docs/technotes/tools/share/jmap.html)
- **格式**: 
	- jmap [ option ] pid
	- jmap [ option ] executable core
	- jmap [ option ] [server-id@]remote-hostname-or-IP
- **示例**:
	- jmap -heap pid 展示pid的整体堆信息
	- jmap -histo pid 展示class的内存情况  jmap -histo:live 这个命令执行，JVM会先触发gc，然后再统计信息。
		instances（实例数）、bytes（大小）、classs name（类名）
	- jmap -dump:live,format=b,file=a.log pid  dump 将内存使用的详细情况输出到文件 查看dump文件实用jhat,访问浏览器 
	   (该命令通常用来分析内存泄漏OOM)
	- jmap -histo <pid>|less  通过命令查看大对象 (退出less ctrol + C)
	- 查看占用内存最多的最象，并按降序排序输出：执行：jmap -histo <pid>|grep alibaba|sort -k 3 -g -r|less
	- jmap -finalizerinfo 打印将要结束的对象的信息

### jhat 
- **定义**: 虚拟机堆转储快照分析 分析Java堆。该jhat命令解析Java堆转储文件并启动Web服务器。jhat命令可以让你浏览堆转储。支持OQL语法
- **官网链接**: [jhat命令](https://docs.oracle.com/javase/7/docs/technotes/tools/share/jhat.html)
- **格式**: jhat [ options ] heap-dump-file
			option参数
			-F : 当正常输出请求不被响应时，强制输出线程堆栈
			-l : 除堆栈外，显示关于锁的附加信息
			-m : 如果调用到本地方法的话，可以显示C/C++的堆栈
- **示例**: 

### jstack
- **定义**: java堆栈跟踪工具 jstack命令主要用于调试java程序运行过程中的线程堆栈信息，可以用于检测死锁，进程耗用cpu过高报警问题的排查。
- **官网链接**: [jstack命令](https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstack.html)
- **格式**:  
	- jstack [ option ] pid
	- jstack [ option ] executable core
	- jstack [ option ] [server-id@]remote-hostname-or-IP
- **示例**:

### jcmd
- **定义**: 一个多功能的工具，可以用它来导出堆、查看Java进程、导出线程信息、执行GC、还可以进行采样分析（jmc 工具的飞行记录器）。
- **格式**: jstat <选项> <pid>
- **示例**:
	- jcmd -l  查看 当前机器上所有的 jvm 进程信息
	- jcmd pid PerfCounter.print  查看性能统计
    - jcmd PID help  列出当前运行的 java 进程可以执行的操作
    - jcmd 646 Thread.print > dump.txt  列出进程的 thread dump



### 参考文献:
[JDK Tools and Utilities](https://docs.oracle.com/javase/8/docs/technotes/tools/)
[jsp命令详解]()



